<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
                    xmlns:Extender1="clr-namespace:Aran.Temporality.CommonUtil.Extender;assembly=Aran.Temporality.CommonUtil"
                    xmlns:Control1="clr-namespace:Aran.Temporality.CommonUtil.Control;assembly=Aran.Temporality.CommonUtil"
                    xmlns:Editor1="clr-namespace:TOSSM.ViewModel.Document.Editor"
                    xmlns:Converter="clr-namespace:TOSSM.Converter;assembly=Aran.Temporality.CommonUtil"
                    xmlns:control="clr-namespace:TOSSM.View.Control"
                    xmlns:control1="clr-namespace:TOSSM.Control"
                    x:Class="TOSSM.Resources.Dictionary.d__m_npanda_aran_temporality_trunk_adm_resources_dictionary_itemtemplates_xaml">



    <ResourceDictionary.MergedDictionaries>

        <ResourceDictionary Source="pack://application:,,,/Aran.Temporality.Resources;component/Resources/Dictionary/Colors.xaml"/>

        <ResourceDictionary>


            <DrawingBrush x:Key="SpliterBrush"  Stretch="UniformToFill" ViewportUnits="Absolute" Viewport="0,0,3,3" TileMode="Tile">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <DrawingGroup.Children>
                            <GeometryDrawing Brush="SteelBlue">
                                <GeometryDrawing.Geometry>
                                    <GeometryGroup FillRule="Nonzero">
                                        <PathGeometry>
                                            <PathFigure StartPoint="0,0">
                                                <LineSegment  Point="100,0"/>
                                                <LineSegment  Point="100,100"/>
                                                <LineSegment  Point="0,100"/>
                                            </PathFigure>
                                        </PathGeometry>
                                    </GeometryGroup>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                            <GeometryDrawing Brush="LightSteelBlue">
                                <GeometryDrawing.Geometry>
                                    <GeometryGroup FillRule="Nonzero">
                                        <PathGeometry>
                                            <PathFigure StartPoint="0,0">
                                                <LineSegment  Point="25,0"/>
                                                <LineSegment  Point="100,75"/>
                                                <LineSegment  Point="100,100"/>
                                                <LineSegment  Point="75,100"/>
                                                <LineSegment  Point="0,25"/>
                                                <LineSegment  Point="0,0"/>
                                            </PathFigure>
                                            <PathFigure StartPoint="75,0">
                                                <LineSegment  Point="100,25"/>
                                                <LineSegment  Point="100,0"/>
                                            </PathFigure>
                                            <PathFigure StartPoint="0,75">
                                                <LineSegment  Point="25,100"/>
                                                <LineSegment  Point="0,100"/>
                                            </PathFigure>
                                        </PathGeometry>
                                    </GeometryGroup>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>

            <Style TargetType="ContentControl" x:Key="EditorContentControlStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Path=ComplexContent.Visibility}" Value="Visible">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard x:Name="SlideStoryboardTo">
                                <Storyboard>
                                    <ThicknessAnimation Storyboard.TargetProperty="Margin" BeginTime="00:00:00" From="-300,0,0,0" To="0,0,0,0" Duration="0:0:0.25">
                                        <ThicknessAnimation.EasingFunction>
                                            <ElasticEase Oscillations="1" Springiness="10" EasingMode="EaseOut"/>
                                        </ThicknessAnimation.EasingFunction>
                                    </ThicknessAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <RemoveStoryboard BeginStoryboardName="SlideStoryboardTo"/>
                        </DataTrigger.ExitActions>
                    </DataTrigger>

                </Style.Triggers>
            </Style>

            <!--<Geometry x:Key="RightArrow2">M0,0 L1,0.5 0,1Z</Geometry>-->


            <ControlTemplate x:Key="LeafMenuWrapperItemTemplate2">
                <Control1:MenuItemWrapper Header="{Binding Path=Header}" Command="{Binding Path=Command}"/>
            </ControlTemplate>

            <ControlTemplate x:Key="TopLevelHeaderWrapperItemTemplate2" TargetType="{x:Type MenuItem}">
                <Grid>
                    <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" />
                    <Popup  Name="Popup"
                                    Placement="Bottom"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    AllowsTransparency="True" 
                                    Focusable="False"
                                    PopupAnimation="Fade">
                        <Border   Name="SubmenuBorder"
                                          SnapsToDevicePixels="True"
                                          Background="#FFFFFF"
                                          BorderBrush="#888888"
                                          BorderThickness="1" >
                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                        </Border>
                    </Popup>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsSuspendingPopupAnimation" Value="true">
                        <Setter TargetName="Popup" Property="PopupAnimation" Value="None"/>
                    </Trigger>
                    <Trigger SourceName="Popup" Property="Popup.AllowsTransparency" Value="True">
                        <Setter TargetName="SubmenuBorder" Property="CornerRadius" Value="0,0,4,4"/>
                        <Setter TargetName="SubmenuBorder" Property="Padding" Value="0,0,0,0"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style x:Key="NoBorderCell" TargetType="DataGridCell">
                <Setter Property="BorderThickness" Value="0" />
            </Style>

            <!-- Selector -->
            <Editor1:EditorPropertyTemplateSelector x:Key="EditorTemplateSelector" />

            <Converter:ImageConverter x:Key="ImageConverter"/>

            <Style x:Key="ValidationTextBox" TargetType="TextBox">
                <Setter Property="Validation.ErrorTemplate">
                    <Setter.Value>
                        <ControlTemplate>
                            <StackPanel>
                                <Border BorderBrush="Red" BorderThickness="1">
                                    <AdornedElementPlaceholder x:Name="AdornedElement"/>

                                    <Border.Triggers>
                                        <EventTrigger RoutedEvent="Border.MouseEnter">
                                            <BeginStoryboard>
                                                <BeginStoryboard.Storyboard>
                                                    <Storyboard Storyboard.TargetName="ValidationPopup" Storyboard.TargetProperty="(Popup.IsOpen)">
                                                        <BooleanAnimationUsingKeyFrames>
                                                            <DiscreteBooleanKeyFrame KeyTime="00:00:00.0" Value="True" />
                                                        </BooleanAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </BeginStoryboard.Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Border.Triggers>
                                </Border>

                                <Popup IsOpen="true" 
                                       x:Name="ValidationPopup"
                                       HorizontalOffset="-6" 
                                       VerticalOffset="-2"
                                       AllowsTransparency="True" 
                                       PlacementTarget="{Binding ElementName=AdornedElement}">


                                    <Border Background="Transparent" Padding="5" >
                                        <Border BorderThickness="1" 
                                            Padding="5,5,10,10"
                                            BorderBrush="Red" >
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStopCollection>
                                                            <GradientStop Color="White" Offset="0.0" />
                                                            <GradientStop Color="Lavender" Offset="1.0" />
                                                        </GradientStopCollection>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>

                                            </Border.Background>
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="5" Color="DarkRed" 
                                                                  
                                                                  Direction="-45" Opacity=".5"
                                                                RenderingBias="Quality" ShadowDepth="3" />
                                            </Border.Effect>


                                            <TextBlock TextWrapping="Wrap" 
                                                   MaxWidth="400" 
                                                   SnapsToDevicePixels="True" >
                                    Validation rule was violated:
                                    <LineBreak/>
                                    <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run FontWeight="Bold" 
                                         Foreground="DarkBlue" 
                                         Text="{Binding Path=AdornedElement.(Validation.Errors)[0].ErrorContent, 
                                         ElementName=AdornedElement}"/>
                                    <LineBreak/><LineBreak/>
                                     Hint:
                                     <LineBreak/>
                                     <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run 
                                         Foreground="DarkBlue" 
                                         Text="Click to close this window. Move mouse over violating value to show it."/>

                                            </TextBlock>
                                        </Border>
                                    </Border>
                                    <Popup.Triggers>
                                        <EventTrigger RoutedEvent="Popup.MouseLeftButtonDown">
                                            <BeginStoryboard>
                                                <BeginStoryboard.Storyboard>
                                                    <Storyboard Storyboard.TargetProperty="(Popup.IsOpen)">
                                                        <BooleanAnimationUsingKeyFrames>
                                                            <DiscreteBooleanKeyFrame KeyTime="00:00:00.0" Value="False" />
                                                        </BooleanAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </BeginStoryboard.Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Popup.Triggers>
                                </Popup>

                            </StackPanel>

                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <!--<Style.Triggers>
                    <Trigger Property="Validation.HasError" Value="true">
                        <Setter Property="ToolTip" Value="{Binding RelativeSource={x:Static RelativeSource.Self},
                                Path=(Validation.Errors)[0].ErrorContent}"/>
                    </Trigger>
                </Style.Triggers>-->
            </Style>

            <!-- DataTemplates -->

            <DataTemplate x:Key="PreviousValueItemTemplate">
                <WrapPanel VerticalAlignment="Center" MaxWidth="400" MaxHeight="300">
                    <Grid>
                        <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                        <TextBlock VerticalAlignment="Center"
                               Visibility="{Binding Path=DeltaVisibility}"
                               Text="{Binding Path=PreviousValueAsString}"
                               Margin="5,0,5,0" TextWrapping="Wrap">
                            <TextBlock.TextDecorations>
                                    <TextDecoration Location="Strikethrough"  PenThicknessUnit="FontRecommended">
                                        <TextDecoration.Pen>
                                            <Pen Brush="Red" Thickness="2"/>
                                        </TextDecoration.Pen>
                                    </TextDecoration>
                            </TextBlock.TextDecorations>
                        </TextBlock>
                        </ScrollViewer>
                        <TextBlock VerticalAlignment="Center"
                               Visibility="{Binding Path=DeltaInvisibility}"
                               Text="{Binding Path=PreviousValueAsString}"
                               Margin="5,0,5,0"/>
                       
                    </Grid>
                </WrapPanel>
                <!--Text="{Binding Path=PreviousStringValue}"-->
            </DataTemplate>

            <DataTemplate x:Key="RestoreOldValueItemTemplate">
                <WrapPanel VerticalAlignment="Center" MaxWidth="400" MaxHeight="300">
                    <Grid Visibility="{Binding Path=ChangedVisibility}" VerticalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" 
                        Command="{Binding Path=OnRestore}" 
                        MinWidth="60"   
                        Margin="5,0,5,0" 
                        VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Restore:" 
                                    VerticalAlignment="Center" 
                                    Margin="5,0,0,0"/>
                                
                            </StackPanel>
                        </Button>
                        <ScrollViewer MaxWidth="400" MaxHeight="300" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" Grid.Column="1">
                        <TextBlock
                            FontWeight="Bold" 
                            Text="{Binding Path=OldStringValue}" 
                            Margin="5,0,5,0" 
                            TextWrapping="Wrap" />
                        </ScrollViewer>
                    </Grid>
                </WrapPanel>
            </DataTemplate>

            <DataTemplate x:Key="DeltaItemTemplate">
                <CheckBox IsChecked="{Binding Path=IsDelta, UpdateSourceTrigger=PropertyChanged}" 
                  IsEnabled="{Binding Path=DeltaEnabled, UpdateSourceTrigger=PropertyChanged}" 
                  Visibility="{Binding Path=DeltaColumnVisibility}"        
                  Margin="5" 
                  VerticalAlignment="Center"/>
            </DataTemplate>

            <DataTemplate x:Key="PropertyItemTemplate">
                <StackPanel Orientation="Horizontal">
                    <Image Source="{Binding Path=PictureId, Converter={StaticResource ImageConverter}}" 
                   Width="16" 
                   Height="16"
                   VerticalAlignment="Center"/>

                    <Label Content="{Binding Path=PropertyName}" VerticalAlignment="Center">
                        <Label.ToolTip>
                            <TextBlock TextWrapping="Wrap" Margin="4,1,4,1" MaxWidth="400" SnapsToDevicePixels="True" >
                        Property description:
                        <LineBreak/>
                        <InlineUIContainer BaselineAlignment="Center">
                             <Path   Data="{StaticResource RightArrow}" 
                                            Width="4" Height="8" 
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Center"
                                            Stretch="Fill"
                                            Margin="1,1,1,0"
                                            Fill="DarkOrange"/>
                        </InlineUIContainer>
                        <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=PropertyDescription}"/>
                            </TextBlock>
                        </Label.ToolTip>
                    </Label>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="DoublePrecisionFormatTemplate">
                <Grid>
                    <control:TraditionalPropertyPrecisionControl 
                        Value="{Binding Path=PrecisionFormat, 
                        Mode=TwoWay, 
                        UpdateSourceTrigger=PropertyChanged, 
                        NotifyOnSourceUpdated=True, 
                        NotifyOnTargetUpdated=True}"
                        
                        EnumValue="{Binding Path=Enum, 
                        Mode=TwoWay, 
                        NotifyOnSourceUpdated=True, 
                        NotifyOnTargetUpdated=True,
                        UpdateSourceTrigger=PropertyChanged}"
                        
                        VerticalAlignment="Center" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="EmptyTemplate">
                <Grid></Grid>
            </DataTemplate>

            <DataTemplate x:Key="ValPrecisionFormatTemplate">
                <Grid>
                    <Expander>
                        <control1:ChildListView ItemsSource="{Binding Path=EnumItems}" 
                                  HorizontalAlignment="Left"
                                  Background="Transparent" 
                                  BorderThickness="0" 
                                  BorderBrush="Transparent">
                            <control1:ChildListView.ItemTemplate>
                                <DataTemplate>
                                    <control:TraditionalPropertyPrecisionControl Value="{Binding Path=PrecisionFormat}"  
                                                        EnumValueDescription="{Binding Path=EnumDescription, 
                                                        Mode=TwoWay, 
                                                        NotifyOnSourceUpdated=True, 
                                                        NotifyOnTargetUpdated=True,
                                                        UpdateSourceTrigger=PropertyChanged}"
                                                        VerticalAlignment="Center"
                                                        EnumValue="{Binding Path=Enum, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </control1:ChildListView.ItemTemplate>

                            <control1:ChildListView.ItemsPanel>
                                <ItemsPanelTemplate >
                                    <VirtualizingStackPanel IsItemsHost="True" Orientation="Vertical"/>
                                </ItemsPanelTemplate>
                            </control1:ChildListView.ItemsPanel>

                            <control1:ChildListView.ItemContainerStyle>
                                <Style TargetType="{x:Type ListBoxItem}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                <ContentPresenter/>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </control1:ChildListView.ItemContainerStyle>
                            
                        </control1:ChildListView>
                    </Expander>
                </Grid>
           </DataTemplate>

            

            <DataTemplate x:Key="ReadOnlyBoolItemTemplate">
                <CheckBox IsChecked="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                      IsEnabled="False"
                     Margin="5"
                     VerticalAlignment="Center"
                      />
            </DataTemplate>

            <DataTemplate x:Key="ReadOnlyDataItemTemplate">
                <Grid>
                    <Control1:ClickSelectTextBox Text="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                     IsReadOnly="True"
                     Margin="5"
                     VerticalAlignment="Center"
                     MinWidth="100" >
                    </Control1:ClickSelectTextBox>
                    <Rectangle Fill="Transparent" Visibility="{Binding ReadOnlyValueToolTipVisibility}">
                        <Rectangle.ToolTip>
                            <ListView ItemsSource="{Binding Path=ReadOnlyValueToolTips}" Margin="0" BorderThickness="0" BorderBrush="Transparent" Background="Transparent">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Margin="0" TextWrapping="Wrap" Background="Transparent" MaxWidth="400" SnapsToDevicePixels="True" >
                                            <Run Text="{Binding Path=Header}"/>
                                            <LineBreak/>
                                            <InlineUIContainer BaselineAlignment="Center">
                                                <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                                </InlineUIContainer>
                                            <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=Message}"/>
                                        </TextBlock>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Rectangle.ToolTip>
                    </Rectangle>

                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ReadOnlyMultiLineDataItemTemplate">
                <Grid>
                    <Control1:ClickSelectTextBox Text="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                     IsReadOnly="True"
                     Margin="5"
                     VerticalAlignment="Center"
                     MinWidth="100" 
                     MaxWidth="800"
                     MinLines="1"
                     MaxLines="10"
                     MinHeight="40"
                     TextWrapping="Wrap">
                    </Control1:ClickSelectTextBox>
                    <Rectangle Fill="Transparent" Visibility="{Binding ReadOnlyValueToolTipVisibility}">
                        <Rectangle.ToolTip>
                            <ListView ItemsSource="{Binding Path=ReadOnlyValueToolTips}" Margin="0" BorderThickness="0" BorderBrush="Transparent" Background="Transparent">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Margin="0" TextWrapping="Wrap" Background="Transparent" MaxWidth="400" SnapsToDevicePixels="True" >
                                            <Run Text="{Binding Path=Header}"/>
                                            <LineBreak/>
                                            <InlineUIContainer BaselineAlignment="Center">
                                                <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                                </InlineUIContainer>
                                            <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=Message}"/>
                                        </TextBlock>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Rectangle.ToolTip>
                    </Rectangle>

                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="EnumItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center"  Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0" 
                              SelectedItem="{Binding Path=EnumValue, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=EnumList, UpdateSourceTrigger=PropertyChanged}" 
                              MinWidth="100" 
                              Margin="5,0,0,0"
                              VerticalAlignment="Center">

                            <ComboBox.ToolTip>
                                <TextBlock TextWrapping="Wrap" MaxWidth="400" SnapsToDevicePixels="True" >
                                    Type description:
                                    <LineBreak/>
                                    <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=EnumTypeDescription}"/>
                                    <LineBreak/><LineBreak/>
                                    Value description:
                                    <LineBreak/>
                                    <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=EnumValueDescription}"/>
                                </TextBlock>
                                </ComboBox.ToolTip>
                        </ComboBox>

                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>



                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="AbstractItemTemplate">

                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Label Grid.Column="0" 
                               Margin="5,0,0,0"
                               Content="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                               VerticalAlignment="Center"
                               MinWidth="100" />

                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />


                        <Menu Grid.Column="2" 
                              Margin="5,0,5,0" 
                              Visibility="{Binding Path=InteractionVisibility}"
                              VerticalAlignment="Center" 
                              VerticalContentAlignment="Center"
                              Background="Transparent">

                            <MenuItem ItemsSource="{Binding Path=AbstractCreateMenu}" Background="Transparent">
                                <MenuItem.Header>
                                    <Border 
                                 Style="{StaticResource ToolBarButtonBorderStyle}"
                                 Width="22" 
                                 Height="22" 
                                 BorderThickness="1" >
                                        <Image Source="{StaticResource AddBitmapImage}"  Margin="2"
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                                    </Border>
                                </MenuItem.Header>
                            </MenuItem>
                        </Menu>

                    </Grid>
                </Grid>
            </DataTemplate>

      <DataTemplate x:Key="ChoiceItemTemplate">
             
                  
             
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>


                        <Label Grid.Column="0" 
                               Margin="5,0,0,0"
                               Content="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                               VerticalAlignment="Center"
                               MinWidth="100" />


                        <StackPanel Orientation="Horizontal" Grid.Column="1">
                            <Button  Margin="5,0,0,0"
                            Command="{Binding Path=OnPaste}"
                                     ToolTip="{Binding PasteToolTip}"
                            Visibility="{Binding Path=ChoiceReferenceVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                                <Image Source="{StaticResource PasteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                            </Button>

                            <Button  
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                                <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>
                       
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />


                        <Menu Grid.Column="2" 
                              Margin="5,0,5,0" 
                              Visibility="{Binding Path=InteractionVisibility}"
                              VerticalAlignment="Center" 
                              VerticalContentAlignment="Center"
                              Background="Transparent">

                            <MenuItem ItemsSource="{Binding Path=ChoiceCreateMenu}" 
                                      Background="Transparent">
                                <MenuItem.Header>
                                    <Border 
                                 Style="{StaticResource ToolBarButtonBorderStyle}"
                                 Width="22" 
                                 Height="22" 
                                 BorderThickness="1" >
                                        <Image Source="{StaticResource AddBitmapImage}"  Margin="2"
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                                    </Border>
                                </MenuItem.Header>
                            </MenuItem>
                        </Menu>

                       


                        <!--<Path Data="{StaticResource DownArrow}"
                                                  Stretch="Fill"
                                                  Width="5"
                                                  Height="3"
                                                  Margin="8,0,0,0"
                                                  Fill="Black" 
                                                  Stroke="Black" 
                                                  VerticalAlignment="Center" 
                                                  HorizontalAlignment="Center"/>-->

                    </Grid>
                </Grid>
            </DataTemplate>


            <DataTemplate x:Key="GeoItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>


                        <TextBox    Grid.Column="0" 
                                    Margin="5,0,0,0"
                                    x:Name="TextBox"
                                    VerticalAlignment="Center"
                                    MinWidth="100"
                                    Text="{Binding Path=GeoTextValue}">

                        </TextBox>

                        <StackPanel Orientation="Horizontal" Grid.Column="1">
                            <Button Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=ClearGeo}">
                                <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                            </Button>

                            <Button  Margin="5,0,5,0"
                            Command="{Binding Path=OnPaste}"
                                     ToolTip="{Binding PasteToolTip}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                                <Image Source="{StaticResource PasteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>
                       
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnPaste}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource PasteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="LinkItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        
                        <TextBlock  Grid.Column="0" 
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    MinWidth="100"
                                    Text="{Binding Path=StringValue}"/>

                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnPaste}"
                            ToolTip="{Binding PasteToolTip}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource PasteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="StringItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=TextBox}"/>
                                    </Trigger>
                                 </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Extender1:BindingExtender Source="{Binding Path=Pattern}" 
                                    Target="{Binding Path=Pattern, ElementName=Rule}"/>
                        <Extender1:BindingExtender Source="{Binding Path=MinimumLength}" 
                                    Target="{Binding Path=MinimumLength, ElementName=Rule}"/>
                        <Extender1:BindingExtender Source="{Binding Path=MaximumLength}" 
                                    Target="{Binding Path=MaximumLength, ElementName=Rule}"/>


                        <!--ToolTip="{Binding Path=ToolTip, UpdateSourceTrigger=PropertyChanged}"-->
                        <TextBox    Grid.Column="0" 
                                    Style="{StaticResource ValidationTextBox}"
                                    Margin="5,0,0,0"
                                    x:Name="TextBox"
                                    VerticalAlignment="Center"
                                    MinWidth="100"
                                    Text="{Binding Value, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}">
                                         
                        </TextBox>
                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>


            <DataTemplate x:Key="MultiLineStringItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=TextBox}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Extender1:BindingExtender Source="{Binding Path=Pattern}" 
                                    Target="{Binding Path=Pattern, ElementName=Rule}"/>
                        <Extender1:BindingExtender Source="{Binding Path=MinimumLength}" 
                                    Target="{Binding Path=MinimumLength, ElementName=Rule}"/>
                        <Extender1:BindingExtender Source="{Binding Path=MaximumLength}" 
                                    Target="{Binding Path=MaximumLength, ElementName=Rule}"/>


                        <!--ToolTip="{Binding Path=ToolTip, UpdateSourceTrigger=PropertyChanged}"-->
                        <TextBox    Grid.Column="0" 
                                    Style="{StaticResource ValidationTextBox}"
                                    Margin="5,0,0,0"
                                    x:Name="TextBox"
                                    VerticalAlignment="Center"
                                    MinWidth="100"
                                    MaxWidth="800"
                                    Text="{Binding Value, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                                    MinLines="1" 
                                    MaxLines="10"
                                    TextWrapping="Wrap"
                                    AcceptsReturn="True">

                        </TextBox>
                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="GuidItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" 
                                 Text="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="5,0,0,0"
                                 VerticalAlignment="Center"
                                 Visibility="{Binding Path=MainValueVisibility}"
                                 MinWidth="100" />

                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>



                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="DateTimeItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <xctk:DateTimePicker 
                Value="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                AutoCloseCalendar="False"
                Format="Custom"
                AllowSpin="True"
                FormatString="yyyy/MM/dd HH:mm"
                TimeFormat="Custom"
                TimeFormatString="HH:mm"
                Margin="5,0,0,0"
                VerticalAlignment="Center"
                Visibility="{Binding Path=MainValueVisibility}"
                MinWidth="100" />

                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="RichTextItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <control:RichTextControl  Text="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" IsReadOnly="False"  Margin="5,0,0,0"
                                                  VerticalAlignment="Center"/>
                        

                        <Button Grid.Column="1" 
                                Margin="5,0,5,0"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding Path=InteractionVisibility}"
                                Style="{StaticResource DeleteButton}" 
                                Command="{Binding Path=OnSetNull}"
                                >
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                   Width="16" 
                                   Height="16" 
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                          Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                                   VerticalAlignment="Center"
                                   Margin="5,0,0,0"
                                   />
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                                  ToolTip="{Binding Path=NilReasonToolTip}"
                                  SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                                  ItemsSource="{Binding Path=NilReasonList}"
                                  Margin="5,0,0,0"
                                  MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                                Command="{Binding Path=OnCreate}"
                                Visibility="{Binding Path=InteractionVisibility}"
                                Style="{StaticResource CreateButton}">
                            <Image Source="{StaticResource AddBitmapImage}" 
                                   Width="16" 
                                   Height="16" 
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="ReadOnlyRichTextItemTemplate">
                <Grid >
                    <control:RichTextControl  Text="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True"  Margin="5,0,0,0"
                                              VerticalAlignment="Center"/>
                    <!--<Control1:ClickSelectTextBox Text="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                                             IsReadOnly="True"
                                             Margin="5"
                                             VerticalAlignment="Center"
                                             MinWidth="100" >
                </Control1:ClickSelectTextBox>-->
                <Rectangle Fill="Transparent" Visibility="{Binding ReadOnlyValueToolTipVisibility}">
                    <Rectangle.ToolTip>
                        <ListView ItemsSource="{Binding Path=ReadOnlyValueToolTips}" Margin="0" BorderThickness="0" BorderBrush="Transparent" Background="Transparent">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Margin="0" TextWrapping="Wrap" Background="Transparent" MaxWidth="400" SnapsToDevicePixels="True" >
                                        <Run Text="{Binding Path=Header}"/>
                                        <LineBreak/>
                                        <InlineUIContainer BaselineAlignment="Center">
                                            <Path   Data="{StaticResource RightArrow}" 
                                                    Width="4" Height="8" 
                                                    VerticalAlignment="Center" 
                                                    HorizontalAlignment="Center"
                                                    Stretch="Fill"
                                                    Margin="1,1,1,0"
                                                    Fill="DarkOrange"/>
                                        </InlineUIContainer>
                                        <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=Message}"/>
                                    </TextBlock>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Rectangle.ToolTip>
                </Rectangle>

                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="ValItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">

                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=Box}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Grid VerticalAlignment="Center" 
                      Visibility="{Binding Path=MainValueVisibility}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <xctk:DoubleUpDown Grid.Column="0" Value="{Binding Path=ValDoubleValue, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="5,0,0,0"
                                               x:Name="Box"
                     VerticalAlignment="Center"
                     MinWidth="40" />
                            <ComboBox Grid.Column="1" 
                          Margin="5,0,0,0" 
                          ItemsSource="{Binding Path=ValEnumList}" 
                          SelectedItem="{Binding Path=ValEnum, UpdateSourceTrigger=PropertyChanged}"
                          MinWidth="60"
                          VerticalAlignment="Center">

                                <ComboBox.ToolTip>
                                    <TextBlock TextWrapping="Wrap" MaxWidth="400" SnapsToDevicePixels="True" >
                                    Type description:
                                    <LineBreak/>
                                    <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=ValEnumTypeDescription}"/>
                                    <LineBreak/><LineBreak/>
                                    Value description:
                                    <LineBreak/>
                                    <InlineUIContainer BaselineAlignment="Center">
                                         <Path   Data="{StaticResource RightArrow}" 
                                                        Width="4" Height="8" 
                                                        VerticalAlignment="Center" 
                                                        HorizontalAlignment="Center"
                                                        Stretch="Fill"
                                                        Margin="1,1,1,0"
                                                        Fill="DarkOrange"/>
                                    </InlineUIContainer>
                                    <Run FontWeight="Bold" Foreground="DarkBlue" Text="{Binding Path=ValEnumValueDescription}"/>
                                    </TextBlock>
                                </ComboBox.ToolTip>
                            </ComboBox>
                        </Grid>


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="BoolItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">
                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <CheckBox IsChecked="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="5,0,0,0"
                     VerticalAlignment="Center"
                     Visibility="{Binding Path=MainValueVisibility}"/>


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ObjectItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>


                        <Label Grid.Column="0" 
                               Margin="5,0,0,0"
                               Content="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                               VerticalAlignment="Center"
                               MinWidth="100" />



                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>

                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>

            </DataTemplate>

            <DataTemplate x:Key="DoubleItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">

                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=Box}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <xctk:DoubleUpDown 
                            Visibility="{Binding Path=MainValueVisibility}"
                            x:Name="Box"
                            Minimum="{Binding Path=NumericMinimum}"
                            Maximum="{Binding Path=NumericMaximum}"
                            Value="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            MinWidth="100" />


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="Int64ItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">

                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=Box}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <xctk:DecimalUpDown 
                     Visibility="{Binding Path=MainValueVisibility}"
                     Value="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="5,0,0,0"
                            x:Name="Box"
                     VerticalAlignment="Center"
                     MinWidth="100" />


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>


            <DataTemplate x:Key="IntItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">

                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=Box}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <xctk:DecimalUpDown 
                     Visibility="{Binding Path=MainValueVisibility}"
                     Value="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="5,0,0,0"
                            x:Name="Box"
                     VerticalAlignment="Center"
                     MinWidth="100" />


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="UIntItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}" Visibility="{Binding Path=DeltaVisibility}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">

                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=Box}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <xctk:DecimalUpDown 
                     Visibility="{Binding Path=MainValueVisibility}"
                            Minimum="0"
                     Value="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                     Margin="5,0,0,0"
                            x:Name="Box"
                     VerticalAlignment="Center"
                     MinWidth="100" />


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ListItemTemplate">
                <Grid IsEnabled="{Binding Path=IsEditable}">

                    <Grid VerticalAlignment="Center" Visibility="{Binding Path=MainValueVisibility}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>


                        <Label Grid.Column="0" 
                       Content="{Binding Path=StringValue, UpdateSourceTrigger=PropertyChanged}" 
                       VerticalAlignment="Center"
                       MinWidth="100" />


                        <Button Grid.Column="1" 
                            Margin="5,0,5,0"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource DeleteButton}" 
                            Command="{Binding Path=OnSetNull}">
                            <Image Source="{StaticResource DeleteBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>


                    <Grid VerticalAlignment="Center"
                      Visibility="{Binding Path=NullReasonVisibility, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Nil Reason:"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                        <ComboBox Grid.Column="1" VerticalAlignment="Center"
                              ToolTip="{Binding Path=NilReasonToolTip}"
                              SelectedItem="{Binding Path=NilReason, UpdateSourceTrigger=PropertyChanged}" 
                              ItemsSource="{Binding Path=NilReasonList}"
                              Margin="5,0,0,0"
                              MinWidth="100"  />
                        <Button Grid.Column="2" Margin="5,0,5,0"
                            Command="{Binding Path=OnCreate}"
                            Visibility="{Binding Path=InteractionVisibility}"
                            Style="{StaticResource CreateButton}"
                            >
                            <Image Source="{StaticResource AddBitmapImage}" 
                                    Width="16" 
                                    Height="16" 
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"/>
                        </Button>
                    </Grid>
                </Grid>

            </DataTemplate>

        </ResourceDictionary>
    </ResourceDictionary.MergedDictionaries>
</ResourceDictionary>